---
phase: 04-visualization
plan: 04
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/components/BriefPanel.tsx
  - frontend/src/hooks/useBriefs.ts
  - frontend/src/components/DashboardLayout.tsx
autonomous: false

must_haves:
  truths:
    - "Right sidebar displays the latest intelligence brief with structured sections"
    - "Brief panel updates in real-time when a new brief is generated"
    - "Brief shows assessment summary, evidence chain, timeline, and collection priorities"
    - "All five dashboard zones are populated with their panel components (banner, map, feed, timeline, brief)"
    - "Dashboard is visually cohesive with consistent light theme and typography"
  artifacts:
    - path: "frontend/src/components/BriefPanel.tsx"
      provides: "Right sidebar intelligence brief display"
      contains: "Assessment"
    - path: "frontend/src/hooks/useBriefs.ts"
      provides: "Briefs data with realtime subscription"
      contains: "briefs"
  key_links:
    - from: "frontend/src/hooks/useBriefs.ts"
      to: "Supabase briefs table"
      via: "initial fetch + realtime INSERT subscription"
      pattern: "briefs"
    - from: "frontend/src/components/BriefPanel.tsx"
      to: "frontend/src/hooks/useBriefs.ts"
      via: "consumes latest brief for display"
      pattern: "useBriefs"
    - from: "frontend/src/components/DashboardLayout.tsx"
      to: "all panel components"
      via: "renders ThreatBanner, MapPanel, EventFeed, NarrativeTimeline, BriefPanel"
      pattern: "BriefPanel"
---

<objective>
Build the intelligence brief sidebar panel, then verify the complete dashboard is visually cohesive with all five zones populated.

Purpose: The intelligence brief panel is the analyst's primary reading material — the formatted assessment with evidence chain and collection priorities. This is the final panel component. After building it, all zones are populated and the dashboard needs a visual coherence pass and human verification.

Output: Complete dashboard with all 5 zones populated, visually cohesive, ready for demo data flow in Phase 5.
</objective>

<execution_context>
@/Users/gremmy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gremmy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-visualization/04-CONTEXT.md
@.planning/phases/04-visualization/04-01-SUMMARY.md
@.planning/phases/04-visualization/04-02-SUMMARY.md
@.planning/phases/04-visualization/04-03-SUMMARY.md
@src/models/schemas.py
@src/processors/brief_generator.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Intelligence brief sidebar panel</name>
  <files>
    frontend/src/components/BriefPanel.tsx
    frontend/src/hooks/useBriefs.ts
    frontend/src/components/DashboardLayout.tsx
  </files>
  <action>
    Create the right sidebar intelligence brief panel — always visible alongside the map.

    **useBriefs hook** (`frontend/src/hooks/useBriefs.ts`):
    - On mount, fetch the most recent brief from `briefs` table: `.select('*').order('generated_at', { ascending: false }).limit(1)`
    - Subscribe to realtime INSERT events on `briefs`
    - When a new brief arrives, replace the current brief state
    - Return: `{ brief: Brief | null, loading: boolean }`

    **BriefPanel component** (`frontend/src/components/BriefPanel.tsx`):
    - Fixed right sidebar with clean prose typography
    - Header: "INTELLIGENCE BRIEF" in small caps with a subtle bottom border
    - If no brief available, show placeholder: "No intelligence brief generated yet. Awaiting correlation engine output." in muted text.
    - If brief available, show structured sections:

      **Section 1 — Assessment** (always visible):
      - Threat level badge: colored pill (GREEN/AMBER/RED) with confidence percentage
      - Summary text: `brief.summary` rendered as clean paragraph text

      **Section 2 — Evidence Chain**:
      - Sub-header: "Evidence" in semibold
      - Render `brief.evidence_chain` as a bulleted list (each item is a string)
      - If evidence_chain is empty/null, show "No evidence chain available"

      **Section 3 — Timeline**:
      - Sub-header: "Timeline" in semibold
      - Render `brief.timeline` as an ordered list
      - If empty, show "No timeline available"

      **Section 4 — Collection Priorities**:
      - Sub-header: "Collection Priorities" in semibold
      - Render `brief.collection_priorities` as a bulleted list
      - If empty, show "No collection priorities"

      **Section 5 — Information Gaps** (if present):
      - Sub-header: "Information Gaps" in semibold, muted/italic
      - Render `brief.information_gaps` as a bulleted list in muted text

    - Typography: Use Inter/system font, text-sm for body, text-xs for labels. Clean spacing between sections (mb-4). No classification markings — user explicitly said "without UNCLASSIFIED // OSINT theater."
    - Container: `overflow-y-auto`, full height of right sidebar zone, `px-4 py-3` padding, white background
    - Generated time: Show `brief.generated_at` as relative time at the bottom in text-xs muted

    **Wire into DashboardLayout**: Replace the brief placeholder with `<BriefPanel />`.

    WHY: User specified clean prose format, professional, structured sections (assessment, evidence, timeline, collection priorities) without classification-style markings. Always visible alongside the map.
  </action>
  <verify>
    Run `npm run dev`, open browser. Right sidebar shows "INTELLIGENCE BRIEF" header and placeholder text (no briefs in DB yet). Insert a test brief: `INSERT INTO briefs (title, summary, threat_level, confidence, evidence_chain, timeline, collection_priorities, information_gaps) VALUES ('Test Brief', 'Elevated coordination detected across state media outlets.', 'AMBER', 67, ARRAY['3 outlets synchronized on Taiwan reunification theme', 'Civilian ferry cancellations reported'], ARRAY['T+0h: Initial coordination detected', 'T+12h: Movement cluster identified'], ARRAY['Monitor PLAN Eastern Theater Command', 'Track civilian ferry schedules'], ARRAY['AIS data gap for submarine activity']);` — brief panel should update to show the structured assessment. `npx tsc --noEmit` passes.
  </verify>
  <done>Brief panel renders in right sidebar with structured sections. Shows placeholder when no brief exists. Auto-updates via realtime when new brief inserted. Clean prose format without classification theater.</done>
</task>

<task type="auto">
  <name>Task 2: Visual polish and layout consistency pass</name>
  <files>
    frontend/src/components/DashboardLayout.tsx
    frontend/src/index.css
  </files>
  <action>
    Do a consistency pass across the complete dashboard to ensure visual cohesion.

    **Typography consistency**:
    - All panel headers: uppercase, text-xs, tracking-wider, text-slate-500, font-semibold
    - All body text: text-sm, text-slate-700
    - All timestamps: text-xs, text-slate-400
    - Consistent font: Inter from Google Fonts (add to index.html) or system font stack

    **Spacing and borders**:
    - Each panel zone has consistent padding: px-3 py-2 (feeds) or px-4 py-3 (brief, timeline)
    - Borders between zones: `border-r border-slate-200` on left panel, `border-t border-slate-200` on bottom panel, `border-l border-slate-200` on right panel
    - No double borders at zone intersections

    **Color consistency**:
    - Background: white for all panels, slate-50 for the overall dashboard background
    - Accent colors only for data (threat levels, tone scores, channel badges)
    - No dark theme elements

    **Loading states**:
    - Each panel shows a subtle loading indicator while initial data fetches
    - Use consistent skeleton loaders: gray-200 rounded rectangles with animate-pulse

    **Empty states**:
    - Each panel shows helpful placeholder text when no data available
    - Muted color, centered or top-aligned based on panel type

    **Ensure the grid does not overflow**: Check that `height: 100vh` on the dashboard container works correctly and all zones fill their allocated space without overflow issues. Test at 1920x1080 resolution.

    WHY: The user specified "modern SaaS analytics feel" with light theme throughout. Consistent typography, spacing, and color treatment across all panels creates this feel.
  </action>
  <verify>
    Run `npm run dev`, open browser at 1920x1080. All 5 zones visible without page scrollbar. Each zone scrolls independently if content overflows. Consistent typography and spacing across panels. No visual inconsistencies. `npx tsc --noEmit` passes.
  </verify>
  <done>Dashboard has consistent visual treatment: typography, spacing, borders, colors, loading states, and empty states are uniform across all panels.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Dragon Watch intelligence dashboard with all 5 zones:
    1. TOP: Threat status banner (GREEN/AMBER/RED with confidence)
    2. LEFT: Event feed (interleaved articles + social posts with realtime updates)
    3. CENTER: Taiwan Strait map (vessel markers with directional heading)
    4. BOTTOM: Narrative correlation timeline (threat score over time with colored zones)
    5. RIGHT: Intelligence brief panel (structured assessment with evidence chain)

    All panels connect to Supabase and subscribe to realtime updates. Light theme, modern SaaS analytics aesthetic.
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd frontend && npm run dev`
    2. Open http://localhost:5173 in your browser
    3. Verify the layout:
       - Threat banner spans full width at top
       - Event feed on the left with scrollable article/post cards
       - Map in the center showing Taiwan Strait
       - Narrative timeline across the bottom
       - Intelligence brief in the right sidebar
    4. Verify the data:
       - Event feed should show ~180 cards (60 articles + 120 posts from demo data)
       - Map should show vessel markers (if Mapbox token set) or fallback placeholder
       - Timeline and brief panels may show empty state (narrative_events and briefs tables are empty)
    5. Verify the feel:
       - Light theme, clean, professional
       - Modern SaaS analytics aesthetic (not dark command center)
       - Consistent typography and spacing
    6. Test realtime (optional): Insert a row in Supabase SQL editor and see it appear
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 4, or describe any issues to address.</resume-signal>
</task>

</tasks>

<verification>
1. Right sidebar shows intelligence brief with structured sections
2. Brief auto-updates when new brief inserted in Supabase
3. All 5 dashboard zones populated with their panel components
4. Consistent visual treatment (typography, spacing, colors, borders)
5. Light theme throughout, modern SaaS analytics feel
6. Loading and empty states handled gracefully
7. No page-level scrollbar at 1920x1080
8. `npx tsc --noEmit` passes
9. Human verification confirms visual quality
</verification>

<success_criteria>
- Intelligence brief panel renders structured sections (assessment, evidence, timeline, priorities, gaps)
- Brief panel auto-updates via Supabase realtime
- All 5 dashboard zones show their panel components (not placeholders)
- Visual consistency across all panels (typography, spacing, colors)
- Dashboard looks professional and clean at 1920x1080
- Human approves the visual quality
</success_criteria>

<output>
After completion, create `.planning/phases/04-visualization/04-04-SUMMARY.md`
</output>
